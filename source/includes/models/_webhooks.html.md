# Webhooks

A webhook represents a subscription to one or more events. This allows you to be informed in near real-time when something happens in Orderspace without the need for polling. When an <a href="#webhook-events">event</a> occurs, Orderspace will send an `HTTP POST` request in `JSON` format to the webhook's endpoint.

Webhooks are created, updated and deleted through the API. 

## The Webhook object

> Example webhook

```json-doc
{
  "webhook": {
    "id":"wh_1q4qn43v",
    "endpoint":"https://webhook.site/6e3931ec-9f4b-4b3a-932f-42f73d1dc45f",
    "events":["order.created", "dispatch.created"],
    "signing_key":"UNxdW7ugYl8PCKjVGkoXkHARkCoFT3eXpdpDsF1s"
  }
}
```

<ul class="attributes">
	<li>
		<h3><span class="name">id</span> <span class="type">string</span></h3>
		<div class="description">Unique auto-generated identifier for the webhook</div>
	</li>
	<li>
		<h3><span class="name">endpoint</span> <span class="type">string</span></h3>
		<div class="description">An HTTPS URL on your server where Orderspace will send events. The endpoint should accept HTTP POST requests in JSON format<div>
	</li>
	<li>
		<h3><span class="name">events</span> <span class="type li">list</span></h3>
		<div class="description">
			A list of <a href="#webhook-events">events</a> that the webhook is subscribed to. Valid events are "customer.created", "customer.updated", "customer.deleted", "dispatch.created", "inventory_level.updated", "invoice.created", "invoice.deleted", "payment.created", "product.created", "product.updated", "product.deleted", "order.created", "order.updated" and "order.deleted"
		</div>
	</li>
	<li>
		<h3><span class="name">signing_key</span> <span class="type">string</span></h3>
		<div class="description">An auto-generated key used to sign the payload of each request to verify that it came from Orderspace. See <a href="#validation">Webhook Events Validation</a> for more details.</div>
	</li>
</ul>

## Create a webhook

> Example request with curl

```shell
curl -X POST https://api.orderspace.com/v1/webhooks \
  -H "Authorization: Bearer {ACCESS TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
  "webhook": {
    "endpoint":"https://webhook.site/6e3931ec-9f4b-4b3a-932f-42f73d1dc45f",
    "events": ["order.created", "dispatch.created"]
  }
}'
```

> Example success response [HTTP 200 Success]

```json-doc
{
  "webhook": {
    "id": "wh_nq479yz6",
    "endpoint": "https://webhook.site/6e3931ec-9f4b-4b3a-932f-42f73d1dc45f",
    "events": ["order.created","dispatch.created"],
    "signing_key": "7R2gNdE4GU8K06WXPV9lOXBic9mSs5LjKMsk46eW"
  }
}
```

> Example error response [HTTP 422 Unprocessable Entity]

```json-doc
{
  "message": "Validation failed: Endpoint can't be blank, Endpoint must be a https url"
}
```

Create a new webhook, subscribing the specified endpoint to a list of events. 

Note that the `signing_key` is generated by Orderspace and should be stored for use in validating events.

### HTTP Request

`POST https://api.orderspace.com/v1/webhooks`

### Response

`HTTP 200 Success` - The webhook object in JSON format

`HTTP 422 Unprocessable Entity` - A message describing the errors

## List webhooks

> Example request with curl

```shell
curl -X GET https://api.orderspace.com/v1/webhooks \
  -H "Authorization: Bearer {ACCESS TOKEN}"
```

> Example success response [HTTP 200 Success]

```json-doc
{
  "webhooks": [
    {
      "id": "wh_o9ernm4p",
      "endpoint":"https://webhook.site/6e3931ec-9f4b-4b3a-932f-42f73d1dc45f",
      "events": ["order.created", "dispatch.created"],
      "signing_key":"UNxdW7ugYl8PCKjVGkoXkHARkCoFT3eXpdpDsF1s"
    },
    {...},
    {...}
  ]
}
```

Retrieve a list of webhooks. Webhooks are returned in the order they are created with the most recently created listed first

### HTTP Request

`GET https://api.orderspace.com/v1/webhooks`

### Response

`HTTP 200 Success` - A list of webhooks in JSON format

## Retrieve a webhook

> Example request with curl

```shell
curl -X GET https://api.orderspace.com/v1/webhooks/wh_o9ernm4p \
  -H "Authorization: Bearer {ACCESS TOKEN}"
```

> Example success response [HTTP 200 Success]

```json-doc
{
  "webhook": {
      "id": "wh_o9ernm4p",
      "endpoint":"https://webhook.site/6e3931ec-9f4b-4b3a-932f-42f73d1dc45f",
      "events": ["order.created", "dispatch.created"],
      "signing_key":"UNxdW7ugYl8PCKjVGkoXkHARkCoFT3eXpdpDsF1s"
    }
}
```

Retrieve a single webhook by ID

### HTTP Request

`GET https://api.orderspace.com/v1/webhooks/:webhook_id`

### Response

`HTTP 200 Success` - The webhook in JSON format

`HTTP 404 Success` - A message describing the error

## Update a webhook

> Example request with curl

```shell
curl -X PUT https://api.orderspace.com/v1/webhooks/wh_o9ernm4p \
  -H "Authorization: Bearer {ACCESS TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
  "webhook": {
    "endpoint":"https://webhook.site/6e3931ec-9f4b-4b3a-932f-42f73d1dc45f",
    "events": ["invoice.created"]
  }
}'
```

> Example success response [HTTP 200 Success]

```json-doc
{
  "webhook": {
      "id": "wh_o9ernm4p",
      "endpoint":"https://webhook.site/6e3931ec-9f4b-4b3a-932f-42f73d1dc45f",
      "events": ["invoice.created"],
      "signing_key":"UNxdW7ugYl8PCKjVGkoXkHARkCoFT3eXpdpDsF1s"
    }
}
```

Update an existing webhook to change the endpoint or list of subscribed events

### HTTP Request

`GET https://api.orderspace.com/v1/webhooks/:webhook_id`

### Response

`HTTP 200 Success` - The webhook in JSON format

`HTTP 404 Success` - A message describing the error

## Delete a webhook

> Example request with curl

```shell
curl -X DELETE https://api.orderspace.com/v1/webhooks/wh_o9ernm4p \
  -H "Authorization: Bearer {ACCESS TOKEN}"
```

> Example success response [HTTP 200 Success]

```json-doc
{
  "webhook": {
      "id": "wh_o9ernm4p",
      "deleted": true
    }
}
```

Delete a webhook. Orderspace will stop sending events to the endpoint

### HTTP Request

`DELETE https://api.orderspace.com/v1/webhooks/:webhook_id`

### Response

`HTTP 200 Success` - A short representation of the webhook in JSON format

`HTTP 404 Success` - A message describing the error

